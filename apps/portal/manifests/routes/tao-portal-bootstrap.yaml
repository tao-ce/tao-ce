---
apiVersion: "gateway.networking.k8s.io/v1"
kind: "HTTPRoute"
metadata:
  name: "tao-portal-bootstrap"
spec:
  hostnames:
  - community.tao.internal
  parentRefs:
  - name: gateway
    namespace: istio-system
  rules:
  # - filters:
  #   - type: RequestRedirect
  #     requestRedirect:
  #       path:
  #         type: ReplacePrefixMatch
  #         replacePrefixMatch: /portal/
  #       statusCode: 301
  - matches:
    - path:
        type: PathPrefix
        value: /sessions
    - path:
        type: PathPrefix
        value: /api
    # filters:
    # - type: "URLRewrite"
      # urlRewrite:
        # path:
          # replacePrefixMatch: "/"
          # type: "ReplacePrefixMatch"
    backendRefs:
    - name: tao-portal-bootstrap
      port: 3000
  - matches:
    - path:
        type: PathPrefix
        value: /portal
    filters:
    - type: "URLRewrite"
      urlRewrite:
        path:
          replacePrefixMatch: "/"
          type: "ReplacePrefixMatch"
    backendRefs:
    - name: tao-portal-bootstrap
      port: 3000
 