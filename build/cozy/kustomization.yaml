
resources:
- ../../manifests/profiles/vm/
- ../../manifests/ingress
- ../tls
- ./manifests/deps
- ./manifests/coredns.yaml
# - ./manifests/poc-sa.yaml

patches:
  - path: ./manifests/setup.yaml
    target:
      kind: TAOSetup
      name: tao-community-edition

replacements:
  - source:
      kind: TAOSetup
      name: tao-community-edition
      fieldPath: spec.publicDomain
    targets:
      - select:
          kind: ConfigMap
          name: coredns-custom
          namespace: kube-system
        fieldPaths:
        - data.[ingress.override]
        options:
          delimiter: " "
          index: 2
      - select:
          kind: Gateway
          name: gateway
          namespace: istio-system
        fieldPaths:
        - spec.listeners.*.hostname

# secretGenerator:
#   - &dockerconfig
#     name: tao-artefacts-poc
#     namespace: default
#     options:
#       disableNameSuffixHash: true
#     files:
#     - .dockerconfigjson=.cache/.dockerconfigjson
#     type: "kubernetes.io/dockerconfigjson"
#   - <<: *dockerconfig
#     namespace: metacontroller